<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SABR METRICS LAB | Ultimate Calculator Edition</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="icon" href="Copilot_20251122_185005.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M4CEZGS8HY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-M4CEZGS8HY');
    </script>
</head>
<body>
    <header style="padding: 2rem 2rem 1rem;">
        <div style="display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; gap:20px; margin-bottom:20px;">
            <div>
                <h1 class="brand" style="font-size:2.5rem; margin-bottom:5px;">SABR<span>METRICS</span> LAB</h1>
                <p class="subtitle" style="margin:0;">Ultimate Baseball Analytics Dictionary</p>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle" title="Dark Mode"></button>
                <button class="theme-toggle" onclick="openToolMenu()" style="width:auto; padding:0 24px; font-weight:800; letter-spacing:0.05em; background:var(--c-text-primary); color:var(--c-bg); border:none; display:flex; align-items:center; gap:8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    <span id="headerToolIcon" style="display:flex;"></span>
                    TOOLS
                </button>
            </div>
        </div>
        <div class="search-wrapper" style="padding:0; margin-bottom:15px;">
            <div class="search-icon" id="searchIcon"></div>
            <input type="text" class="search-input" id="searchInput" placeholder="指標名、意味、計算式で検索" oninput="handleSearch()">
        </div>
        <div class="filter-scroll" style="padding:0; justify-content:flex-start;">
            <div class="filter-chip active" onclick="filterCategory('all')" data-cat="all">ALL</div>
            <div class="filter-chip" onclick="filterCategory('std')" data-cat="std">基本</div>
            <div class="filter-chip" onclick="filterCategory('bat')" data-cat="bat">打撃</div>
            <div class="filter-chip" onclick="filterCategory('pit')" data-cat="pit">投球</div>
            <div class="filter-chip" onclick="filterCategory('fld')" data-cat="fld">守備走塁</div>
            <div class="filter-chip" onclick="filterCategory('tot')" data-cat="tot">総合</div>
        </div>
    </header>

    <div style="max-width: 1200px; margin: 0 auto; padding: 50px 2rem 0;">
        <details class="footer-details" style="border-color: var(--cat-bat); background: var(--bg-bat); margin-bottom: 20px;">
            <summary class="footer-summary" style="font-weight:800; color:var(--cat-bat);">
                <span class="footer-icon" id="footerAlertIcon" style="display:flex; margin-right:8px;"></span> 
                <span>【重要】当サイトの指標と計算ロジックについて</span>
            </summary>
            <div class="footer-content">
                <div class="warning-msg" style="margin-bottom: 30px; display:block; border-left: 4px solid #f59e0b; background: #fffbeb; color: #1e293b;">
                    <strong style="display:block; margin-bottom:8px; color:#b45309;"> 指標の解釈に関するご注意</strong>
                    当サイトで算出される指標（WAR, wRC+, xFIPなど）は、ユーザーが入力した限られたデータを基に計算される<strong>「概算値」</strong>です。<br>
                    公式記録や専門サイト（1.02やFanGraphs等）の厳密な算出値とは、データの粒度や補正係数の違いにより<strong>必ず乖離が発生します。</strong><br>
                    SNS等で数値を共有・引用される際は、公式記録と混同されないようご配慮をお願いいたします。
                </div>
                <div><h3>計算ロジックの前提</h3><p>入力項目として存在しないデータ...（中略）</p></div>
            </div>
        </details>
    </div>
        
    <script>
        let lastScrollY = window.scrollY;
        window.addEventListener('scroll', () => {
            const currentScrollY = window.scrollY;
            if (currentScrollY > 60) document.body.classList.add('scrolled');
            else document.body.classList.remove('scrolled');
            lastScrollY = currentScrollY;
        }, { passive: true });
    </script>

    <div class="grid-container" id="grid"></div>

    <footer class="footer-area">
        <div style="text-align:center; color:var(--c-text-secondary); padding:20px;">
            <p style="margin:0; font-weight:600;">SABR METRICS LAB</p>
            <p style="margin:5px 0 0; font-size:0.8rem;">Ultimate Baseball Analytics Dictionary</p>
        </div>
    </footer>
    
    <div class="modal-overlay" id="modal" onclick="closeModalOutside(event)">
        <div class="modal-panel">
            <div class="modal-header" id="modal-header">
                <button class="close-btn" onclick="closeModal()">×</button>
                <div id="modal-title-area"></div>
            </div>
            <div class="modal-body" id="modal-body-content"></div>
        </div>
    </div>

    <div id="galaxy-overlay">
        <div id="galaxy-universe">
            <div id="galaxy-cosmos">
                <svg id="galaxy-lines"></svg>
                <div id="galaxy-nodes"></div>
            </div>
        </div>
        <div class="galaxy-controls">
            <button class="g-btn" onclick="zoomIn()" title="拡大"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg></button>
            <button class="g-btn" onclick="zoomOut()" title="縮小"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="8" x2="16" y1="12" y2="12"/></svg></button>
            <button class="g-btn" onclick="fitToScreen()" title="リセット"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M16 3h3a2 2 0 0 1 2 2v3"/><path d="M8 21H5a2 2 0 0 1-2-2v-3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg></button>
            <div style="width:1px; height:24px; background:rgba(255,255,255,0.2); margin:auto 5px;"></div>
            <button class="g-btn close" onclick="closeMindMap()" title="閉じる"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
        </div>
        <canvas id="starfield-canvas"></canvas>
    </div>

    <div id="career-overlay">
        <div class="career-header">
            <div class="career-brand">MY CAREER <span>SIMULATION</span></div>
            <button class="g-btn close" onclick="closeCareerSim()" title="閉じる">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        <div class="career-content" id="career-content"></div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/core.js"></script>
    <script src="js/app.js"></script>
    <script src="js/features/batch.js"></script>
    <script src="js/features/career.js"></script>
    <script src="js/features/galaxy.js"></script>
    <script>
        initApp();
        render();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js').then(registration => {
                    registration.onupdatefound = () => {
                        const installingWorker = registration.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) console.log('New content is available; please refresh.');
                        };
                    };
                });
            });
            let refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });
        }
    </script>
</body>
</html>
